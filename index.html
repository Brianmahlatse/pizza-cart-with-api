<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/login.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="PizzaCartAPI.js" defer></script>
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
        integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <title>Pizza Cart</title>
</head>

<body x-data="pizzaCart">


    <div class="container " x-show="!usernameSet">
        <div class="box card">

            <h2 class="login-header">Login</h2>
            <form action="#">

                <div class="input_box">
                    <input x-model="username" type="text" class="username" required>
                    <label>Username</label>
                </div>
                <div class="d-flex justify-content-center">
                    <button @click="setUsername()" class="login_button">Login</button>
                </div>


            </form>
        </div>
    </div>

    <main x-show="usernameSet" class="bg-body" x-init="getDataFromStorage()">

        <div class="header">
            <h1 x-text="title"></h1>
            <button @click="logout()" class="logout-button">Logout</button>
            <button @click="orderHistory()" x-show="!displayHistory" class="orderHistory">Order History</button>
            <button @click="newOrder()" x-show="displayHistory" class="newOrder">New Order</button>
        </div>

        <div x-show="displayHistory">
            <template x-for="cart in historyCartsIds">
                <div x-init="getPastOrders(cart.cart_code)"></div>
            </template>
            <div>
                <div class="text-center"x-show="pastOrderedPizzas.length===0">
                    <h1><span>You have no previous orders</span></h1>
                </div>
                <template x-for="pizzaOrder in pastOrderedPizzas">

                    <div>

                        <div>
                            <table class="table table-striped  table-responsive{-sm|-md|-lg|-xl} receipt">

                                <thead>
                                    <tr>
                                        <th colspan="5">
                                            <h4 class="text-center">Receipt ID: <span x-text="pizzaOrder.cartId"></span>
                                            </h4>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>Flavour</th>
                                        <th>Size</th>
                                        <th>Price</th>
                                        <th>Qty</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <template x-for="pizza in pizzaOrder.pizzas">
                                        <tr>
                                            <td class="w-auto" x-text="pizza.flavour"></td>
                                            <td class="w-auto" x-text="pizza.size"></td>
                                            <td class="w-auto" x-text="pizza.price"></td>
                                            <td class="w-auto" x-text="pizza.qty"></td>
                                            <td class="w-auto" x-text="priceFormat(pizza.total)"></td>
                                        </tr>
                                    </template>
                                    <tr>
                                        <td class="w-auto" colspan="4">Total</td>

                                        <td class="w-auto">R<span x-text="priceFormat(pizzaOrder.total)"></span></td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </template>
            </div>

        </div>
        <div>

        </div>
        <div x-show="!displayHistory">
            <section class="">

                <section class="pizza" x-init="getFeaturedPizzas()">
                    
                    <template x-for="pizza in featuredPizzas">
                        
                        <section class="small-pizza">

                            <img :src="getPizzaImageSource(pizza.size)" alt="Pizza" />
                            <div class="price">
                                <h2><span x-text="pizza.size"> </span> Pizza</h2>
                                <h3>R<span x-text="pizza.price"></span></h3>
                                <h3>Flavour: <span x-text="pizza.flavour"></span></h3>
                                <h3>Type: <span x-text="pizza.type"></span></h3>

                            </div>
                            <div class="toppings-description">

                            </div>
                            <div class="buyBtn d-flex justify-content-center mt-10">
                                <button @click="addToCart(pizza.id)" class="w-75 buy-featured">Buy</button>
                            </div>
                        </section>
                        
                    </template>

                </section>



                <section class="pizza-list">

                    <table x-show="cartTotal>0"
                        class="table table-striped table-dark table-responsive{-sm|-md|-lg|-xl}">

                        <thead>
                            <tr x-show="message!==''">
                                <th class="mx-auto" colspan="5" x-text="message"></th>
                            </tr>
                            <tr>
                                <th>Flavour</th>
                                <th>Size</th>
                                <th>Price</th>

                                <th>Qty</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>

                            <template x-for="pizza in cartPizzas">
                                <tr>
                                    <td class="w-auto" x-text="pizza.flavour"></td>
                                    <td class="w-auto" x-text="pizza.size"></td>
                                    <td class="w-auto" x-text="pizza.price"></td>
                                    <td class="w-auto">

                                        <button @click="addToCart(pizza.id)" class="rounded-circle">
                                            +
                                        </button>
                                        <span x-text="pizza.qty"></span>
                                        <button @click="removeFromCart(pizza.id)" class="rounded-circle">
                                            -
                                        </button>
                                    </td>
                                    <td class="w-auto" x-text="priceFormat(pizza.total)"></td>
                                </tr>
                            </template>
                            <tr>
                                <td class="w-auto" colspan="4">Total</td>

                                <td class="w-auto">R<span x-text="priceFormat(cartTotal)"></span></td>
                            </tr>
                            <tr>
                                <td class="w-auto" colspan="3">Pay now</td>
                                <td class="w-auto"><input placeholder="Enter numbers only" x-model="paymentAmount" />
                                </td>

                                <td @click="payPizza()" class="w-auto pay-pizza-button"><button>Pay</button></td>
                            </tr>

                        </tbody>
                    </table>

                </section>

            </section>


            <section class="pizza-gallery">
                <template x-for="pizza in pizzas">
                    
                    <div class="pizza-box">
                        <div class="pizzas" x-bind:class="{
                      'small-pizza': pizza.size === 'small',
                      'medium-pizza': pizza.size === 'medium',
                      'large-pizza': pizza.size === 'large'
                    }">
                            <div class="pizza-info">
                                <span class="pizza-size" x-text="pizza.size"></span>
                                <span class="pizza-type" x-text="pizza.type"></span>
                                <span class="pizza-flavour" x-text="pizza.flavour"></span>
                                <span class="pizza-price" x-text="pizza.price"></span>
                            </div>
                            <button @click="addToCart(pizza.id)" class="add-to-cart-btn">Add to Cart</button>
                        </div>
                    </div>
                </template>
            </section>

        </div>

    </main>

</body>

</html>